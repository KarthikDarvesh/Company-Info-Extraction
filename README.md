# üß† Company_Info_Extraction
---
# ‚úíÔ∏èPART 1
---
---

## üìã Overview

This **n8n workflow** is designed to **automate the extraction of detailed company information** from input documents (generated by **STORM**) combined with an integrated **LLM (Large Language Model)**, producing a **fully structured company profile**.

---

## üìã List of Extracted Parameters

The workflow extracts and organizes the following major sections:

- ‚úÖ **Company_Name**

- ‚úÖ **Basic_Overview**
  - Legal Name
  - Type of Entity
  - Traded As (BSE, NSE, ISIN, Ticker Symbol)
  - Industry, Sector, Year Founded
  - Founders
  - Headquarters (Address, Contact Details)
  - Key People (with roles, bios, tenure)
  - Mission & Vision
  - Values, Tags

- ‚úÖ **Business_Segments**
  - Segment Details, Products & Services, Competitors
  - Sub-segments, KPIs, Market Share, Growth Rate

- ‚úÖ **Corporate_Structure**
  - Market Cap, Enterprise Value
  - Shareholding Patterns
  - Subsidiaries, Divisions, Joint Ventures, Affiliates

- ‚úÖ **Financial_Highlights**
  - Latest Financials (Revenue, Net Income, EPS, AUM)
  - Cash Flow, Ratios, Historical Data, Growth Drivers

- ‚úÖ **Company_History**
  - Key Historical Events, Milestones, Impacts

- ‚úÖ **Acquisitions_And_Partnerships**
  - M&A Activity, Partnerships, Outcomes

- ‚úÖ **Operations_And_Strategies**
  - Tech Investments, Expansions, Sustainability, BCPs

- ‚úÖ **SWOT_Analysis**
  - Strengths, Weaknesses, Opportunities, Threats

- ‚úÖ **Controversies_And_Legal_Issues**
  - Regulatory Actions, Outcomes, Reputation Impacts

- ‚úÖ **Awards_And_Recognitions**
  - Awards, Categories, Issuers, Significance

- ‚úÖ **Strategic_And_Market_Position**
  - Investment Philosophy, Distribution, Branding

- ‚úÖ **Recent_Strategic_Focus_And_Outlook**
  - Digitization, Growth, Risks, Management Guidance

- ‚úÖ **Conclusion**
  - Summary of the Full Company Profile

---
## N8N WORKFLOW
![image](https://github.com/user-attachments/assets/2d8ccfb7-39e1-4a9d-a1a8-ab88372c4c6d)

## üì• Part 1 ‚Üí Input Ingestion & Preprocessing

**Purpose:**

This section pulls raw company data files (from **Google Drive**), extracts their contents, loops over Excel rows, applies any needed cleaning/patching, and prepares them for summary analysis.

---

### 1Ô∏è‚É£ Schedule Trigger

**‚öô What It Does:**  
Automatically starts the workflow on a defined schedule (e.g., daily, weekly).

### 2Ô∏è‚É£ Google Drive Node

**Name of the Node:** `Google Drive`  
**‚öô What It Does:**  
Connects to Google Drive to pull the target Excel file containing company data.

### 3Ô∏è‚É£ Extract from File Node

**Name of the Node:** `Node Excel File`  
**‚öô What It Does:**  
Reads the Excel file content and parses it into usable JSON rows.

### 4Ô∏è‚É£ Loop Over Node

**Name of the Node:** `Loop Over Items - 1`  
**‚öô What It Does:**  
Iterates over each extracted row from the Excel file to process one company at a time.

### 5Ô∏è‚É£ Edit Node

**Name of the Node:** `Select Company Name and Website`  
**‚öô What It Does:**  
Transforms the data by rearranging or modifying fields.  
Here, it selects only the **Company Name and Website** from all parameters to proceed further.

### 6Ô∏è‚É£ AI Agent ‚Äì (Gemini Model - google/gemini-2.0-flash-001)

**Name of the Node:** `Title and Response Generate`  
**‚öô What It Does:**  
Integrates with the Gemini LLM model.

- **Model:** `google/gemini-2.0-flash-001`
- **Input:** Company Name and Website
- **Output:** Uses a crafted prompt that generates **50 enriched Titles and Responses** for each company, covering all company information parameters.
  
### 7Ô∏è‚É£ Code Node

**Name of the Node:** `Cleaning Node`  
**‚öô What It Does:**  
Runs additional cleanup to remove noise, special characters, or irrelevant content from the text.

- Cleans up strings
- Removes triple backticks if present
- Fixes common issues (like unnecessary escape characters)
- Converts the string into actual JSON

### 8Ô∏è‚É£ Loop Over Item (Split in Batches) Node

**Name of the Node:** `Loop Over Items - 2`  
**‚öô What It Does:**  
Iterates over each cleaned Title and Response, processing one company at a time and preparing for external API calls.

### 9Ô∏è‚É£ HTTP Request

**Name of the Node:** `STORM API`  
**‚öô What It Does:**  
Sends API requests to **STORM** to get additional responses or enrichments.


---

## üîÑ Part 2 ‚Üí Dual Path Processing (With & Without Summary)

**Purpose:**

This part intelligently splits the flow:

- ‚úÖ **If the API response exists ‚Üí** it‚Äôs passed forward for merging and profiling.
- ‚ùå **If the API response does not exist ‚Üí** it is passed to a second HTTP Request (STORM API) to retrieve the missing response.

### 1Ô∏è‚É£ Edit Node

**Name of the Node:** `Title/Response/Summary - 1`  
**‚öô What It Does:**  
After completing all 50 iterations of API calls, this node reorganizes the data ‚Äî structuring it into **Title, Response, and API-Response** from the previous HTTP loop.

### 2Ô∏è‚É£ IF Node

**Name of the Node:** `if`  
**‚öô What It Does:**  
Checks if an API-Response exists and splits the flow into two branches:

- üîµ **True branch:** has API-Response
- üî¥ **False branch:** missing API-Response

## üîµ True Branch ‚Üí Merge and Clean ‚Üí Wait at Merge Node Input 1

- **Code Node**  
  **Name:** `Merging entire text before brand profiling result - 1`  
  **‚öô What It Does:**  
  Merges all existing API-Response texts together, preparing for the next cleaning step.

- **Code Node**  
  **Name:** `Cleaning code node before brand profiling_1`  
  **‚öô What It Does:**  
  Cleans the merged text by:
  - Removing all escaped newline characters (`\n` or `\\n`)
  - Removing curly brackets `{` and `}`
  - Removing all double quotes (`"`)

- **Merge Node (Input 1)**  
  **Name:** `Merge`  
  **‚öô What It Does:**  
  After cleaning, the text proceeds to **Merge Node Input 1** and waits for **Input 2**.

## üî¥ False Branch ‚Üí Retry Missing Responses ‚Üí Merge and Clean ‚Üí Wait at Merge Node Input 2

- **Code Node**  
  **Name:** `PassesFilter`  
  **‚öô What It Does:**  
  Filters out items where API-Response is empty or null.

- **Edit Node**  
  **Name:** `Select Company Name and Website - 2`  
  **‚öô What It Does:**  
  Rearranges the data; selects Company Name and Website again to prepare for another HTTP API call.

- **Loop Over Items (Split in Batches)**  
  **Name:** `Loop Over Items - 3`  
  **‚öô What It Does:**  
  Iterates over each extracted Company Name and Website to process them individually through the next API call.

- **HTTP Request**  
  **Name:** `STORM API - 2`  
  **‚öô What It Does:**  
  Sends API requests to the **STORM system** to retrieve missing responses.

- **Edit Node**  
  **Name:** `Title/Response/Summary - 2`  
  **‚öô What It Does:**  
  After completing all iterations, this node reorganizes the data into **Title, Response, and API-Response** from the second HTTP loop.

- **Filter Node**  
  **Name:** `Filter`  
  **‚öô What It Does:**  
  Checks that only items with now-filled API-Responses proceed (filters out anything still empty or null).

- **Code Node**  
  **Name:** `Merging entire text before brand profiling result - 2`  
  **‚öô What It Does:**  
  Merges all new API-Response texts together, preparing for final cleaning.

- **Code Node**  
  **Name:** `Cleaning code node before brand profiling_2`  
  **‚öô What It Does:**  
  Cleans the merged text by:
  - Removing all escaped newline characters (`\n` or `\\n`)
  - Removing curly brackets `{` and `}`
  - Removing all double quotes (`"`)

- **Merge Node (Input 2)**  
  **Name:** `Merge`  
  **‚öô What It Does:**  
  After cleaning, the text proceeds to **Merge Node Input 2**.

## üü¢ Final Combination

- **Code Node**  
  **Name:** `Merge Both Clean Text`  
  **‚öô What It Does:**  
  Combines the merged text from **Input 1 and Input 2** into one complete, long text block for downstream processing.

---

## üì§ Part 3: Final Combination & Data Output

### 1Ô∏è‚É£ Code Node: 
**Name:** `Merge Both Clean Text`
**‚öô What It Does:**  
Combines the merged text from **Input 1 and Input 2** into one complete, long text block for downstream processing.

### 2Ô∏è‚É£ AI Agent (Deepseek Model - deepseek/deepseek-r1-distill-qwen-32b): 
**Name:** `Brand Profiling`
**‚öô What It Does:**  
Processes the combined text using a **crafted prompt** with the integrated **DeepSeek R1 Qwine 70B Free Model** to extract all required company parameters: Business, Financials, Operations, Strategy, and More

### 3Ô∏è‚É£ Edit Node: 
**Name:** `Company_Info_Output`
**‚öô What It Does:**  
Passes the result from the AI Agent forward **without making changes**, preparing it for JSON formatting.

### 4Ô∏è‚É£ Code Node: 
**Name:** `Company_Info_Output TO JSON Format`
**‚öô What It Does:**  
Converts the AI Agent‚Äôs output into a **well-structured JSON format** to ensure it‚Äôs clean and ready for **database insertion**.

### 5Ô∏è‚É£ Postgres Node: 
**Name:** `Insert Data To Company_Details Table`
**‚öô What It Does:**  
Inserts the finalized **structured company profile data** into the `Company_Details` table in **PostgreSQL** for permanent storage.

---

## üåê API Endpoint Details

| **Route**      | `/get_article`                                  |
|----------------|-------------------------------------------------|
| **Method**     | `GET`                                           |
| **Test URL**   | `http://localhost:8000/get_article/`            |
| **Content-Type** | `application/json`                             |

### üîç What It Does

This API is powered by **FastAPI + Selenium automation** and is used to:

- ‚úÖ Launch **Chrome** (with rotating profiles)
- ‚úÖ Visit the **STORM Stanford platform**  
  ‚û°Ô∏è [https://storm.genie.stanford.edu/](https://storm.genie.stanford.edu/)
- ‚úÖ Automatically fill in the **Title & Response** fields for each company
- ‚úÖ Generate and extract an **article** that acts as a **knowledge base** for the AI agent

The article is used downstream in **n8n** to help the AI Agent (Model) fill in all detailed company information parameters:
Business, Finance, Strategy, History, and More

### üö® Note

- **Selenium automation** is used because the STORM platform **does not expose a direct API**, so the automation simulates human browsing to fetch content.
- üìÑ The **generated article** acts as an **input document** to feed into the AI agent for complete company profiling downstream.

---

## üñ•Ô∏è Running the Service

To start the FastAPI server locally, run the following command:

```
uvicorn routes:app --host 0.0.0.0 --port 8000 --reload
```
###
---
---
# ‚úíÔ∏èPART 2
---
---

## N8N WORKFLOW - (WITHOUT RELAYING ON THE STORM API)
![image](https://github.com/user-attachments/assets/f6d11cc8-759d-4d40-9a33-117ee89fd13f)

## üìã Overview

This workflow is designed to **automatically generate detailed company profiles** using only the **input parameters provided**‚Äîwithout relying on the STORM API or any third-party data enrichment tools.

## üõ† Workflow Nodes & Descriptions
---

### 1Ô∏è‚É£ Schedule Trigger Node
**‚öô What It Does:**  
Starts the workflow automatically (time-based schedule).

### 2Ô∏è‚É£ Google Sheets Node
**Name of the Node:** `Google Sheets`  
**‚öô What It Does:**  
Reads the sheet where company data is stored.

### 3Ô∏è‚É£ Loop Over Node
**Name of the Node:** `Loop Over Items - 1`  
**‚öô What It Does:**  
Iterates through each row of data (likely each company).

### 4Ô∏è‚É£ Edit Node
**Name of the Node:** `SELECT Company Name, Industry, Symbol, ISIN Code`  
**‚öô What It Does:**  
Extracts:
- Company Name
- Industry
- Symbol
- ISIN Code

### 5Ô∏è‚É£ AI Agent Node (Deepseek Model - deepseek/deepseek-r1-distill-qwen-32b):
**Name of the Node:** `Extract Company Name`  
**‚öô What It Does:**  
Takes all parameters as input and uses a **crafted prompt with the integrated DeepSeek R1 Qwine 70B Free Model** to extract all required company parameters, including:
Business, Financials, Operations, Strategy, and More

### 6Ô∏è‚É£ Edit Node
**Name of the Node:** `Company_Info_Output`  
**‚öô What It Does:**  
Collects the AI output and **passes the result from the AI Agent.**

### 7Ô∏è‚É£ Code Node
**Name of the Node:** `Return Cleaned Output`  
**‚öô What It Does:**  
Ensures the AI output is **cleaned and well-structured JSON.**

### 8Ô∏è‚É£ Code Node
**Name of the Node:** `Company_Info_Output TO JSON Format`  
**‚öô What It Does:**  
Converts the result into **strict JSON** (ready for database insertion).

### 9Ô∏è‚É£ Postgres Node (Insert)
**Name of the Node:** `Insert_Result_To_Companies_Details_Table`  
**‚öô What It Does:**  
Inserts the final **structured JSON** into your Postgres database.

